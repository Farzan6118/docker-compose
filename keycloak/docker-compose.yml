version: "3.9"
services:
  postgres:
    container_name: Keycloak_PostgreSQL
    environment:
      - POSTGRES_DB=${POSTGRES_DB}
      - POSTGRES_USER=${DEFAULT_USERNAME}
      - POSTGRES_PASSWORD=${DEFAULT_PASSWORD}
      # - PGDATA=/data/postgres
    image: ${POSTGRES_IMAGE}
    ports:
      - 5433:5432
    restart: ${RESTART_MODE}
    volumes:
      - ./postgres_data:/data/postgres

  keycloak:
    container_name: Keycloak
    depends_on:
      - postgres
    environment:
      PROXY_ADDRESS_FORWARDING: "true"
      DB_VENDOR: POSTGRES
      DB_ADDR: postgres
      DB_DATABASE: ${POSTGRES_DB}
      DB_USER: ${DEFAULT_USERNAME}
      DB_PASSWORD: ${DEFAULT_PASSWORD}
      KEYCLOAK_USER: ${DEFAULT_USERNAME}
      KEYCLOAK_PASSWORD: ${DEFAULT_PASSWORD}
    image: ${KEYCLOAK_IMAGE}
    # networks:
    #   - postgres_keycloak
    restart: ${RESTART_MODE}
    ports:
      - 8180:8080
      - 8787:8787
